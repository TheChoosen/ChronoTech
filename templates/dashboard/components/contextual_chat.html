<!-- Widget Chat Contextuel -->
<div class="contextual-chat-widget clay-card mb-4" id="contextual-chat-widget">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h5 class="mb-0">
            <i class="fa-solid fa-comments me-2 text-primary"></i>
            Chat Contextuel
            <span class="badge bg-success ms-2" id="online-users-count">0</span>
        </h5>
        <div class="d-flex gap-2">
            <button class="btn btn-sm btn-outline-primary" id="toggle-chat-notifications" title="Notifications">
                <i class="fa-solid fa-bell"></i>
            </button>
            <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#teamChatModal" title="Vue complète">
                <i class="fa-solid fa-expand"></i>
            </button>
        </div>
    </div>
    <div class="card-body p-0">
        <!-- Zone des messages -->
        <div class="chat-messages-container" id="chat-messages-container" style="height: 200px; overflow-y: auto;">
            <div class="text-center py-3">
                <i class="fa-solid fa-comments fa-2x mb-2 text-muted"></i>
                <p class="mb-0 text-muted">Aucun message récent</p>
                <small class="text-muted">Commencez une conversation</small>
            </div>
        </div>
        
        <!-- Zone de saisie -->
        <div class="chat-input-container p-2 border-top">
            <div class="input-group input-group-sm">
                <input type="text" class="form-control" id="chat-quick-message" 
                       placeholder="Tapez votre message..." 
                       maxlength="500">
                <button class="btn btn-primary" type="button" id="send-quick-message">
                    <i class="fa-solid fa-paper-plane"></i>
                </button>
            </div>
        </div>
        
        <!-- Indicateur de frappe -->
        <div class="typing-indicator p-2 d-none" id="typing-indicator">
            <small class="text-muted">
                <i class="fa-solid fa-ellipsis fa-fade"></i>
                <span id="typing-users">Quelqu'un</span> tape...
            </small>
        </div>
    </div>
</div>

<style>
.chat-messages-container {
    background-color: #f8f9fa;
}

.chat-message {
    padding: 8px 12px;
    margin: 4px 0;
    border-radius: 8px;
    max-width: 85%;
}

.chat-message.own {
    background-color: #007bff;
    color: white;
    margin-left: auto;
    text-align: right;
}

.chat-message.other {
    background-color: white;
    border: 1px solid #dee2e6;
    margin-right: auto;
}

.chat-message-meta {
    font-size: 0.75em;
    opacity: 0.7;
    margin-top: 2px;
}

.typing-indicator {
    background-color: rgba(0, 123, 255, 0.1);
    border-radius: 0 0 8px 8px;
}
</style>

<script>
// Initialisation du widget chat contextuel
document.addEventListener('DOMContentLoaded', function() {
    // Ce script sera géré par contextual-chat.js
    if (typeof ContextualChat !== 'undefined') {
        window.contextualChatWidget = new ContextualChat();
    } else {
        console.warn('⚠️ ContextualChat class non trouvée - chat contextuel désactivé');
    }
});
</script>

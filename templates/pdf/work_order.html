<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bon de Travail #{{ work_order.id }} - ChronoTech</title>
    <style>
        @page {
            size: A4;
            margin: 2cm;
            @bottom-center {
                content: "Page " counter(page) " sur " counter(pages);
                font-size: 10px;
                color: #666;
            }
        }
        
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            font-size: 12px;
            line-height: 1.4;
            color: #333;
            margin: 0;
            padding: 0;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 2cm;
            border-bottom: 2px solid #2c5282;
            padding-bottom: 20px;
        }
        
        .logo-section {
            flex: 1;
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #2c5282;
            margin-bottom: 10px;
        }
        
        .company-info {
            font-size: 10px;
            color: #666;
        }
        
        .document-info {
            text-align: right;
            flex: 1;
        }
        
        .doc-title {
            font-size: 20px;
            font-weight: bold;
            color: #2c5282;
            margin-bottom: 10px;
        }
        
        .doc-number {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .doc-date {
            font-size: 12px;
            color: #666;
        }
        
        .section {
            margin-bottom: 25px;
        }
        
        .section-title {
            font-size: 14px;
            font-weight: bold;
            color: #2c5282;
            margin-bottom: 10px;
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 5px;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .info-box {
            background: #f8fafc;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #2c5282;
        }
        
        .info-label {
            font-weight: bold;
            color: #4a5568;
            margin-bottom: 5px;
        }
        
        .info-value {
            font-size: 13px;
        }
        
        .priority-high {
            color: #e53e3e;
            font-weight: bold;
        }
        
        .priority-medium {
            color: #dd6b20;
            font-weight: bold;
        }
        
        .priority-low {
            color: #38a169;
            font-weight: bold;
        }
        
        .status-pending {
            background: #fef5e7;
            color: #744210;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
        }
        
        .status-in-progress {
            background: #e6fffa;
            color: #234e52;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
        }
        
        .status-completed {
            background: #f0fff4;
            color: #22543d;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
        }
        
        .tasks-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .tasks-table th,
        .tasks-table td {
            border: 1px solid #e2e8f0;
            padding: 10px;
            text-align: left;
            vertical-align: top;
        }
        
        .tasks-table th {
            background: #f7fafc;
            font-weight: bold;
            color: #2d3748;
        }
        
        .task-row:nth-child(even) {
            background: #f8fafc;
        }
        
        .footer {
            margin-top: 40px;
            border-top: 1px solid #e2e8f0;
            padding-top: 20px;
            font-size: 10px;
            color: #666;
        }
        
        .signatures {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-top: 30px;
        }
        
        .signature-box {
            text-align: center;
            border: 1px solid #e2e8f0;
            padding: 20px;
            height: 80px;
            position: relative;
        }
        
        .signature-label {
            position: absolute;
            bottom: 5px;
            left: 0;
            right: 0;
            font-size: 10px;
            color: #666;
        }
        
        .notes-section {
            background: #f8fafc;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #2c5282;
        }
        
        .print-only {
            display: none;
        }
        
        @media print {
            .print-only {
                display: block;
            }
            .no-print {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- En-t√™te du document -->
    <div class="header">
        <div class="logo-section">
            <div class="logo">ChronoTech</div>
            <div class="company-info">
                Syst√®me de Gestion d'Interventions<br>
                {{ company_address or "123 Rue de l'Innovation, 75001 Paris" }}<br>
                T√©l: {{ company_phone or "01 23 45 67 89" }} | Email: {{ company_email or "contact@chronotech.fr" }}
            </div>
        </div>
        <div class="document-info">
            <div class="doc-title">BON DE TRAVAIL</div>
            <div class="doc-number">#{{ work_order.id }}</div>
            <div class="doc-date">{{ work_order.created_at.strftime('%d/%m/%Y') if work_order.created_at else "Date non d√©finie" }}</div>
            <div class="doc-date">
                <span class="status-{{ work_order.status }}">{{ work_order.status.upper() if work_order.status else "STATUT INCONNU" }}</span>
            </div>
        </div>
    </div>

    <!-- Informations client et v√©hicule -->
    <div class="section">
        <div class="section-title">üìã Informations G√©n√©rales</div>
        <div class="info-grid">
            <div class="info-box">
                <div class="info-label">Client</div>
                <div class="info-value">
                    {{ work_order.customer_name or "Nom non d√©fini" }}<br>
                    {% if work_order.customer_email %}Email: {{ work_order.customer_email }}<br>{% endif %}
                    {% if work_order.customer_phone %}T√©l: {{ work_order.customer_phone }}{% endif %}
                </div>
            </div>
            <div class="info-box">
                <div class="info-label">V√©hicule</div>
                <div class="info-value">
                    {{ work_order.vehicle_make or "Marque" }} {{ work_order.vehicle_model or "Mod√®le" }}<br>
                    {% if work_order.vehicle_year %}Ann√©e: {{ work_order.vehicle_year }}<br>{% endif %}
                    {% if work_order.vehicle_plate %}Immat: {{ work_order.vehicle_plate }}{% endif %}
                </div>
            </div>
        </div>
        <div class="info-grid">
            <div class="info-box">
                <div class="info-label">Priorit√©</div>
                <div class="info-value priority-{{ work_order.priority or 'medium' }}">
                    {{ work_order.priority.upper() if work_order.priority else "MOYENNE" }}
                </div>
            </div>
            <div class="info-box">
                <div class="info-label">Technicien Assign√©</div>
                <div class="info-value">
                    {{ work_order.technician_name or "Non assign√©" }}
                </div>
            </div>
        </div>
    </div>

    <!-- Description du probl√®me -->
    {% if work_order.description %}
    <div class="section">
        <div class="section-title">üìù Description du Probl√®me</div>
        <div class="notes-section">
            {{ work_order.description }}
        </div>
    </div>
    {% endif %}

    <!-- T√¢ches √† effectuer -->
    <div class="section">
        <div class="section-title">üîß T√¢ches √† Effectuer</div>
        {% if tasks %}
        <table class="tasks-table">
            <thead>
                <tr>
                    <th style="width: 5%">#</th>
                    <th style="width: 40%">Description</th>
                    <th style="width: 15%">Priorit√©</th>
                    <th style="width: 15%">Statut</th>
                    <th style="width: 25%">Notes</th>
                </tr>
            </thead>
            <tbody>
                {% for task in tasks %}
                <tr class="task-row">
                    <td>{{ loop.index }}</td>
                    <td>
                        <strong>{{ task.title or "T√¢che sans titre" }}</strong>
                        {% if task.description %}
                        <br><small>{{ task.description }}</small>
                        {% endif %}
                    </td>
                    <td class="priority-{{ task.priority or 'medium' }}">
                        {{ task.priority.upper() if task.priority else "MOYENNE" }}
                    </td>
                    <td>
                        <span class="status-{{ task.status or 'pending' }}">
                            {{ task.status.upper() if task.status else "EN ATTENTE" }}
                        </span>
                    </td>
                    <td>
                        {% if task.estimated_minutes %}
                        Estimation: {{ task.estimated_minutes }}min<br>
                        {% endif %}
                        {% if task.scheduled_start %}
                        Programm√©: {{ task.scheduled_start.strftime('%d/%m %H:%M') }}<br>
                        {% endif %}
                        {{ task.notes or "" }}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div class="notes-section">
            <em>Aucune t√¢che sp√©cifique d√©finie. Voir description du probl√®me ci-dessus.</em>
        </div>
        {% endif %}
    </div>

    <!-- Pi√®ces d√©tach√©es (si d√©finies) -->
    {% if parts %}
    <div class="section">
        <div class="section-title">üî© Pi√®ces D√©tach√©es</div>
        <table class="tasks-table">
            <thead>
                <tr>
                    <th style="width: 50%">R√©f√©rence / Description</th>
                    <th style="width: 15%">Quantit√©</th>
                    <th style="width: 20%">Prix Unitaire</th>
                    <th style="width: 15%">Total</th>
                </tr>
            </thead>
            <tbody>
                {% for part in parts %}
                <tr class="task-row">
                    <td>{{ part.reference or part.description }}</td>
                    <td>{{ part.quantity or 1 }}</td>
                    <td>{{ "%.2f ‚Ç¨"|format(part.unit_price) if part.unit_price else "N/A" }}</td>
                    <td>{{ "%.2f ‚Ç¨"|format((part.quantity or 1) * (part.unit_price or 0)) if part.unit_price else "N/A" }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}

    <!-- Notes importantes -->
    {% if work_order.notes %}
    <div class="section">
        <div class="section-title">üìå Notes Importantes</div>
        <div class="notes-section">
            {{ work_order.notes }}
        </div>
    </div>
    {% endif %}

    <!-- Zone de signatures -->
    <div class="section">
        <div class="section-title">‚úçÔ∏è Signatures</div>
        <div class="signatures">
            <div class="signature-box">
                <div class="signature-label">Signature Client</div>
            </div>
            <div class="signature-box">
                <div class="signature-label">Signature Technicien</div>
            </div>
        </div>
    </div>

    <!-- Pied de page -->
    <div class="footer">
        <div style="text-align: center;">
            <strong>ChronoTech - Syst√®me de Gestion d'Interventions</strong><br>
            Document g√©n√©r√© le {{ current_datetime.strftime('%d/%m/%Y √† %H:%M') if current_datetime else datetime.now().strftime('%d/%m/%Y √† %H:%M') }}<br>
            <em>Ce document fait foi pour l'ex√©cution des travaux d√©crits ci-dessus</em>
        </div>
    </div>
</body>
</html>

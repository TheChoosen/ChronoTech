{% extends 'layout.html' %}

{% block content %}
<div class="clay-container clay-container-sm">
    <!-- Header avec animation d'entrée -->
    <header class="text-center clay-fade-in" style="animation-delay: 0.1s;">
        <h1 class="clay-title-primary mb-4">
            <i class="fas fa-edit clay-icon-warning mr-3"></i>
            Modifier la ligne
        </h1>
        <p class="clay-subtitle">Édition des détails de la ligne de bon de travail</p>
    </header>

    <!-- Carte de formulaire d'édition -->
    <div class="clay-card clay-card-elevated clay-fade-in" style="animation-delay: 0.2s;">
        <form method="post" class="clay-form">
            <div class="clay-form-group">
                <label for="CODE" class="clay-label">Code pièce/opération</label>
                <input type="text" id="CODE" name="CODE" class="clay-input" value="{{ line.CODE }}" required>
            </div>
            
            <div class="clay-form-group">
                <label for="DESC" class="clay-label">Description détaillée</label>
                <textarea id="DESC" name="DESC" class="clay-textarea" rows="3" required>{{ line.DESC }}</textarea>
            </div>
            
            <div class="clay-grid clay-grid-2">
                <div class="clay-form-group">
                    <label for="QUANT" class="clay-label">Quantité</label>
                    <input type="number" step="0.01" id="QUANT" name="QUANT" class="clay-input" value="{{ line.QUANT }}" required>
                </div>
                
                <div class="clay-form-group">
                    <label for="COUT" class="clay-label">Coût unitaire</label>
                    <input type="number" step="0.01" id="COUT" name="COUT" class="clay-input" value="{{ line.COUT }}" required>
                </div>
            </div>
            
            <div class="clay-form-group">
                <label for="STATUS" class="clay-label">Statut de la ligne</label>
                <select id="STATUS" name="STATUS" class="clay-select" required>
                    <option value="pending" {{ 'selected' if line.STATUS == 'pending' else '' }}>En attente</option>
                    <option value="completed" {{ 'selected' if line.STATUS == 'completed' else '' }}>Terminé</option>
                    <option value="cancelled" {{ 'selected' if line.STATUS == 'cancelled' else '' }}>Annulé</option>
                </select>
            </div>
            
            <!-- Affichage du montant calculé -->
            <div class="clay-info-card">
                <div class="clay-info-header">
                    <i class="fas fa-calculator clay-icon-info mr-2"></i>
                    Calcul automatique
                </div>
                <div class="clay-info-content">
                    <div class="clay-calc-display">
                        <span class="clay-calc-label">Montant total:</span>
                        <span class="clay-calc-value" id="montant-display">{{ "%.2f"|format(line.COUT * line.QUANT) }} €</span>
                    </div>
                </div>
            </div>
            
            <div class="clay-button-group clay-button-group-spread">
                <a href="{{ url_for('work_order_lines', work_order_id=line.work_order_id) }}" 
                   class="clay-btn clay-btn-secondary clay-btn-lg">
                    <i class="fas fa-arrow-left mr-2"></i>
                    Retour
                </a>
                <button type="submit" class="clay-btn clay-btn-primary clay-btn-lg clay-ripple">
                    <i class="fas fa-save mr-2"></i>
                    Enregistrer
                </button>
            </div>
        </form>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const quantInput = document.getElementById('QUANT');
    const coutInput = document.getElementById('COUT');
    const montantDisplay = document.getElementById('montant-display');
    
    function updateMontant() {
        const quant = parseFloat(quantInput.value) || 0;
        const cout = parseFloat(coutInput.value) || 0;
        const total = quant * cout;
        montantDisplay.textContent = total.toFixed(2) + ' €';
        
        // Animation sur le changement
        montantDisplay.style.transform = 'scale(1.1)';
        setTimeout(() => {
            montantDisplay.style.transform = 'scale(1)';
        }, 200);
    }
    
    quantInput.addEventListener('input', updateMontant);
    coutInput.addEventListener('input', updateMontant);
    
    // Validation en temps réel
    const form = document.querySelector('.clay-form');
    const inputs = form.querySelectorAll('input[required], textarea[required], select[required]');
    
    inputs.forEach(input => {
        input.addEventListener('blur', function() {
            if (this.value.trim() === '') {
                this.classList.add('clay-input-error');
            } else {
                this.classList.remove('clay-input-error');
            }
        });
    });
});
</script>

{% endblock %}

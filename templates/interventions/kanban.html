{% extends "base.html" %}

{% block title %}Vue Kanban - Interventions - ChronoTech{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/claymorphism.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/kanban.css') }}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
{% endblock %}

{% block content %}
<div class="kanban-container" style="background: var(--bg-color); min-height: 100vh; padding: 1rem;">
    
    <!-- En-tête avec statistiques et filtres -->
    <div class="kanban-header clay-card" style="margin-bottom: 1rem; padding: 1.5rem;">
        <div class="header-content" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
            
            <!-- Titre et statistiques -->
            <div class="header-left">
                <h1 style="margin: 0 0 0.5rem; color: var(--text-color); font-size: 1.8rem;">
                    <i class="fas fa-columns"></i> Vue Kanban - Interventions
                </h1>
                <div class="stats-row" style="display: flex; gap: 1rem; flex-wrap: wrap;">
                    <span class="stat-badge" id="total-count" style="background: var(--primary-color); color: white; padding: 0.25rem 0.75rem; border-radius: 1rem; font-size: 0.85rem;">
                        <i class="fas fa-list"></i> Total: <span>0</span>
                    </span>
                    <span class="stat-badge" id="urgent-count" style="background: var(--danger-color); color: white; padding: 0.25rem 0.75rem; border-radius: 1rem; font-size: 0.85rem;">
                        <i class="fas fa-exclamation-triangle"></i> Urgent: <span>0</span>
                    </span>
                    <span class="stat-badge" id="overdue-count" style="background: var(--warning-color); color: white; padding: 0.25rem 0.75rem; border-radius: 1rem; font-size: 0.85rem;">
                        <i class="fas fa-clock"></i> En retard: <span>0</span>
                    </span>
                    <span class="stat-badge" id="progress-count" style="background: var(--info-color); color: white; padding: 0.25rem 0.75rem; border-radius: 1rem; font-size: 0.85rem;">
                        <i class="fas fa-play"></i> En cours: <span>0</span>
                    </span>
                </div>
            </div>
            
            <!-- Contrôles et filtres -->
            <div class="header-right" style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
                <div class="filter-group" style="display: flex; gap: 0.5rem; align-items: center;">
                    <select id="technician-filter" class="form-control" style="min-width: 150px;">
                        <option value="">Tous les techniciens</option>
                    </select>
                    <select id="priority-filter" class="form-control">
                        <option value="">Toutes priorités</option>
                        <option value="urgent">Urgent</option>
                        <option value="high">Élevée</option>
                        <option value="medium">Moyenne</option>
                        <option value="low">Faible</option>
                    </select>
                    <input type="date" id="date-filter" class="form-control" style="max-width: 150px;">
                </div>
                <div class="action-buttons" style="display: flex; gap: 0.5rem;">
                    <button id="refresh-btn" class="btn btn-outline-primary btn-sm">
                        <i class="fas fa-sync-alt"></i> Actualiser
                    </button>
                    <button id="auto-refresh-toggle" class="btn btn-outline-secondary btn-sm" data-active="true">
                        <i class="fas fa-play"></i> Auto-refresh
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Kanban Board -->
    <div class="kanban-board" id="kanban-board" style="display: flex; gap: 1rem; overflow-x: auto; min-height: 600px; padding-bottom: 1rem;">
        <!-- Les colonnes seront générées dynamiquement -->
    </div>

    <!-- Loader -->
    <div class="loader-overlay" id="loader" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; justify-content: center; align-items: center;">
        <div class="spinner-border text-primary" role="status">
            <span class="sr-only">Chargement...</span>
        </div>
    </div>

</div>

<!-- Modal pour les détails d'intervention -->
<div class="modal fade" id="interventionModal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Détails de l'intervention</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="intervention-details">
                <!-- Contenu chargé dynamiquement -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Fermer</button>
                <button type="button" class="btn btn-primary" id="open-full-details">Ouvrir les détails complets</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal pour assignation -->
<div class="modal fade" id="assignModal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Assigner l'intervention</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="technician-select">Choisir un technicien:</label>
                    <select id="technician-select" class="form-control">
                        <option value="">Sélectionner un technicien...</option>
                    </select>
                </div>
                <div id="technician-workload" class="mt-3" style="display: none;">
                    <small class="text-muted">
                        <i class="fas fa-info-circle"></i> 
                        Charge actuelle: <span id="workload-info"></span>
                    </small>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Annuler</button>
                <button type="button" class="btn btn-primary" id="confirm-assign" disabled>Assigner</button>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
<script src="{{ url_for('static', filename='js/intervention-kanban.js') }}"></script>
{% endblock %}
